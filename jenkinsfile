pipeline {
    agent any
    environment {
        DOCKER_IMAGE = 'your-image-name' // Specify the image name here
        DOCKER_NETWORK = 'my_custom_network'
    }
    stages {
        stage('Prepare Environment') {
            steps {
                script {
                    // Clean up any existing Docker containers or networks if necessary
                    sh "docker network rm ${DOCKER_NETWORK} || true" // Remove network if exists
                    sh "docker rm -f ${DOCKER_IMAGE}-container || true" // Remove existing container
                    sh "docker rmi ${DOCKER_IMAGE} || true" // Remove image if exists
                }
            }
        }

        stage('Create Network') {
            steps {
                script {
                    // Create a custom Docker network
                    sh "docker network create ${DOCKER_NETWORK}"
                }
            }
        }

        stage('Build Docker Image') {
            steps {
                script {
                    // Build the Docker image
                    sh "docker build -t ${DOCKER_IMAGE} ."
                }
            }
        }

        stage('Run Docker Container') {
            steps {
                script {
                    // Run the Docker container on the created network
                    sh "docker run -d --name ${DOCKER_IMAGE}-container --network ${DOCKER_NETWORK} ${DOCKER_IMAGE}"
                }
            }
        }

        stage('Clean Up') {
            steps {
                script {
                    // Optionally clean up containers/images if you don't need to keep them
                    sh "docker rm -f ${DOCKER_IMAGE}-container"
                    sh "docker rmi ${DOCKER_IMAGE}"
                }
            }
        }
    }
    post {
        success {
            echo 'Deployment was successful!'
        }
        failure {
            echo 'Deployment failed.'
        }
    }
}
